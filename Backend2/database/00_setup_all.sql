-- ============================================================================
-- SETUP COMPLETO DE BASE DE DATOS - EXPERT FINDER
-- ============================================================================
-- Este script ejecuta todas las Historias de Usuario en orden
-- Autor: Sistema Expert Finder
-- Fecha: Enero 2026
-- ============================================================================

SELECT '
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    EXPERT FINDER - DATABASE SETUP                          โ
โ                         Instalaciรณn Completa                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ  Este script ejecutarรก en orden:                                          โ
โ    1. HU 2.1 - Creaciรณn de esquema y tablas                               โ
โ    2. HU 2.2 - Restricciones de integridad                                โ
โ    3. HU 2.3 - Prevenciรณn de duplicados + รndices + Triggers              โ
โ    4. HU 2.4 - Vistas para consultas                                      โ
โ    5. HU 2.5 - Pruebas de integridad                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
' as titulo;

SELECT 'โณ Iniciando instalaciรณn...' as estado;
SELECT NOW() as fecha_inicio;

-- ============================================================================
-- HU 2.1: CREACIรN DE ESQUEMA Y TABLAS
-- ============================================================================
SELECT '
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ EJECUTANDO: HU 2.1 - Creaciรณn de esquema y tablas                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
' as paso_1;

source 2.1SQL.sql;

-- ============================================================================
-- HU 2.2: RESTRICCIONES DE INTEGRIDAD
-- ============================================================================
SELECT '
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ EJECUTANDO: HU 2.2 - Restricciones de integridad                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
' as paso_2;

source 2.2SQL.sql;

-- ============================================================================
-- HU 2.3: PREVENCIรN DE DUPLICADOS (Incluye Triggers)
-- ============================================================================
SELECT '
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ EJECUTANDO: HU 2.3 - Prevenciรณn de duplicados + รndices + Triggers        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
' as paso_3;

source 2.3SQL.sql;

-- ============================================================================
-- HU 2.4: VISTAS PARA CONSULTAS
-- ============================================================================
SELECT '
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ EJECUTANDO: HU 2.4 - Vistas para consultas                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
' as paso_4;

source 2.4SQL.sql;

-- ============================================================================
-- HU 2.5: PRUEBAS DE INTEGRIDAD
-- ============================================================================
SELECT '
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ EJECUTANDO: HU 2.5 - Pruebas de integridad                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
' as paso_5;

source 2.5SQL.sql;

-- ============================================================================
-- RESUMEN FINAL
-- ============================================================================
SELECT '
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      โ INSTALACIรN COMPLETADA                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ  Base de datos: expert_finder_db                                          โ
โ  Estado: Lista para usar                                                  โ
โ  Triggers: Incluidos en HU 2.3                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ  PRรXIMOS PASOS:                                                          โ
โ                                                                            โ
โ  1. Verificar conexiรณn desde Python:                                      โ
โ     cd Backend && python test_db.py                                       โ
โ                                                                            โ
โ  2. Iniciar el servidor backend:                                          โ
โ     python run.py                                                         โ
โ                                                                            โ
โ  3. Acceder a la documentaciรณn:                                           โ
โ     http://localhost:8080/docs                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
' as resumen_final;

-- Mostrar tablas creadas
USE expert_finder_db;
SELECT 'Tablas disponibles:' as info;
SHOW TABLES;

-- Mostrar vistas creadas
SELECT 'Vistas disponibles:' as info;
SHOW FULL TABLES WHERE Table_type = 'VIEW';

-- Estadรญsticas finales
SELECT 
    'Base de datos' as componente,
    'expert_finder_db' as nombre,
    'Activa' as estado
UNION ALL
SELECT 
    'Tablas',
    CAST(COUNT(*) AS CHAR),
    'Creadas'
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'expert_finder_db' AND TABLE_TYPE = 'BASE TABLE'
UNION ALL
SELECT 
    'Vistas',
    CAST(COUNT(*) AS CHAR),
    'Creadas'
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'expert_finder_db' AND TABLE_TYPE = 'VIEW'
UNION ALL
SELECT 
    'Foreign Keys',
    CAST(COUNT(*) AS CHAR),
    'Configuradas'
FROM information_schema.TABLE_CONSTRAINTS 
WHERE TABLE_SCHEMA = 'expert_finder_db' AND CONSTRAINT_TYPE = 'FOREIGN KEY'
UNION ALL
SELECT 
    'รndices',
    CTriggers',
    CAST(COUNT(*) AS CHAR),
    'Creados (en HU 2.3)'
FROM information_schema.TRIGGERS 
WHERE TRIGGER
SELECT NOW() as fecha_finalizacion;
SELECT '๐ ยกSistema listo para usar!' as mensaje;
